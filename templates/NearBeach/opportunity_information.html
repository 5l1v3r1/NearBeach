{% extends "./template.html" %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'NearBeach/javascript/chosen-js/chosen.css' %}">
<link rel="stylesheet" href="{% static 'NearBeach/javascript/chosen-js/docsupport/prism.css' %}">

<body>
    <form action="{% url 'opportunity_information' opportunity_id %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <h2>Opportunity Information</h2>
        <table>
            <tr class="header"><td width="250px">Field</td><td>Input</td></tr>
            <tr><td>Opportunity Name:</td><td>{{ opportunity_information_form.opportunity_name }}</td></tr>
            <tr><td>Opportunity Description:</td><td>{{ opportunity_information_form.opportunity_description }}</td></tr>
            <tr><td>Lead Source:</td><td>{{ opportunity_results.lead_source_id }}</td></tr>
            <tr><td>Organisation:</td><td>{{ opportunity_results.organisations_id }}</td></tr>
            <tr><td>Customer:</td><td>
                <select>
                    <option value="">-------</option>
                    {% for row in customer_results %}
                        {% if row.customer_id == opportunity_results.customer_id.customer_id %}
                            <option value="{{ row.customer_id }}" selected>
                        {% else %}
                            <option value="{{ row.customer_id }}">
                        {% endif %}
                        {{ row.customer_first_name }} {{ row.customer_last_name }}</option>
                    {% endfor %}
                </select>
            </td></tr>
            <tr><td>Opportunity Amount:</td><td>
                {{ opportunity_information_form.currency_id }}
                {{ opportunity_information_form.opportunity_amount }}
                {{ opportunity_information_form.amount_type_id }}
            </td></tr>
            <tr><td>Opportunity Expected Close Date:</td><td>
                {{ opportunity_information_form.finish_date_year }}
                {{ opportunity_information_form.finish_date_month }}
                {{ opportunity_information_form.finish_date_day }}
                @ {{ opportunity_information_form.finish_date_hour }}:{{ opportunity_information_form.finish_date_minute }}
                {{ opportunity_information_form.finish_date_meridiems }}</td></tr>
            <tr><td>Opportunity Stage:</td><td>{{ opportunity_information_form.opportunity_stage_id }}</td></tr>
            <tr><td>Opportunity Success Probability:</td><td>{{ opportunity_information_form.opportunity_success_probability }}</td></tr>
        </table>
        <input type="submit" name="submit_contact" value="Update"/>
        <h2>To Do</h2>
        <table>
            <tr>
                <td>{{ opportunity_information_form.next_step }}</td>
                <td><input type="submit" name="submit_next_step" value="Add To Do"/></td>
            </tr>
            {% if next_step_results %}
                <tr class="header">
                    <td>Next Step</td>
                    <td width="20%"> ---- </td>
                </tr>
                {% for row in next_step_results %}
                    <tr>
                        <td>{{ row.next_step_description }}</td>
                        {% if row.next_step_completed == 0 %}
                            <td><a href="{% url 'next_step' row.id opportunity_results.opportunity_id %}">Click to Complete</a></td>
                        {% else %}
                            <td>Completed</td>
                        {% endif %}
                    </tr>
                {% endfor %}
            {% else %}
                <tr><td>There are currently no to do</td></tr>
            {% endif %}
        </table>
        <h2>Associated Projects & Tasks</h2>
        <ul>
            {% if opportunity_results.customer_id %}
                <li><a href="{% url 'new_project' opportunity_results.organisations_id.organisations_id opportunity_results.customer_id.customer_id opportunity_id %}">Create New Project</a></li>
                <li><a href="{% url 'new_task' opportunity_results.organisations_id.organisations_id opportunity_results.customer_id.customer_id opportunity_id %}">Create New Task</a></li>
            {% else %}
                <li><a href="{% url 'new_project' opportunity_results.organisations_id.organisations_id 0 opportunity_id %}">Create New Project</a></li>
                <li><a href="{% url 'new_task' opportunity_results.organisations_id.organisations_id 0 opportunity_id %}">Create New Task</a></li>

            {% endif %}

        </ul>
        <h2>Assigned Projects</h2>
        {% if project_results %}
            <table>
                <tr class="header">
                    <td>Project ID</td>
                    <td>Project Name</td>
                    <td>Project End Date</td>
                    <td>Project Status</td>
                </tr>
                {% for row in project_results %}
                    <tr>
                        <td><a href="#">PRO{{ row.project_id.project_id }}</a></td>
                        <td>{{ row.project_id.project_name }}</td>
                        <td>{{ row.project_id.project_end_date }}</td>
                        <td>{{ row.project_id.project_status }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>There are no associated projects. Please create a new project</p>
        {% endif %}
        <br/>
        <h2>Assigned Tasks</h2>
        {% if tasks_results %}
            <table>
                <tr class="header">
                    <td>Task ID</td>
                    <td>Project Name</td>
                    <td>Project End Date</td>
                    <td>Project Status</td>
                </tr>
                {% for row in tasks_results %}
                    <tr>
                        <td><a href="#">TASK{{ row.tasks_id.tasks_id }}</a></td>
                        <td>{{ row.tasks_id.task_short_description }}</td>
                        <td>{{ row.tasks_id.task_end_date }}</td>
                        <td>{{ row.tasks_id.task_status }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>There are no associated tasks. Please create a new task</p>
        {% endif %}

        <h2>Opportunity Quotes</h2>
        <a href="{% url 'new_quote' opportunity_id 'opportunity' %}">New Quote</a>
        {% if quote_results %}
            <table>
                <tr>
                    <td width="50%">Quote Title</td>
                    <td width="25%">Valid Till</td>
                    <td width="25%">Quote Stage</td>
                </tr>
                {% for row in quote_results %}
                    <tr>
                        <td>{{ row.quote_title }}</td>
                        <td>{{ row.quote_valid_till }}</td>
                        <td>{{ row.quote_stage_id }}</td>
                    </tr>
                {% endfor %}
            </table>
        {% endif %}


        <h2>Opportunity Permissions</h2>
        <p>Please note - if there are NO permissions added to an opportunity then everyone will have access to the
            opportunity</p>
        <h3>Group Permissions</h3>
        <table>
            <tr>
                <td width="80%">{{ opportunity_information_form.select_groups }}</td>
                <td width="20%"><input type="submit" name="submit_contact" value="Add Group(s)"/></td>
            </tr>
            {% if group_permissions %}
                {% for row in group_permissions %}
                    <tr>
                        <td>{{ row.groups_id }}</td>
                        <td><a href="{% url 'delete_opportunity_permission' opportunity_results.opportunity_id row.groups_id.group_id '0' %}">Delete Permission</a></td>
                    </tr>
                {% endfor %}
            {% endif %}
        </table>



        <h3>User Permissions</h3>
        <table>
            <tr>
                <td width="80%">{{ opportunity_information_form.select_users }}</td>
                <td width="20%"><input type="submit" name="submit_contact" value="Add User(s)"/></td>
            </tr>
            {% if user_permissions %}
                {% for row in user_permissions %}
                    <tr>
                        <td>{{ row.username }} - {{ row.first_name }} {{ row.last_name }}</td>
                        <td><a href="{% url 'delete_opportunity_permission' opportunity_results.opportunity_id '0' row.id %}">Delete Permission</a></td>
                    </tr>
                {% endfor %}
            {% endif %}
        </table>
        <script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/chosen.jquery.js' %}"></script>
        <script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/docsupport/prism.js' %}"></script>
        <script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/docsupport/init.js' %}"></script>
    </form>
<div name="blank_space" style="margin-bottom: 150px;"></div>
</body>
{% endblock %}