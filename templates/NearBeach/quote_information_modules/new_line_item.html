{% load static %}
<link rel="stylesheet" href="{% static 'NearBeach/javascript/chosen-js/chosen.css' %}">
<link rel="stylesheet" href="{% static 'NearBeach/javascript/chosen-js/docsupport/prism.css' %}">

<table id="product">
    <tr class="header">
        <td width="70%" colspan="2">Add Product/Service</td>
        <td width="5%" style="display: none;">Quantity</td>
        <td width="20%" style="display: none;">Cost</td>
    </tr>
    <tr>
        <td colspan="2">{{ new_line_item_form.products_and_services }}</td>
        <td style="display: none;">{{ new_line_item_form.quantity }}</td>
        <td style="display: none;">{{ new_line_item_form.product_cost }}</td>
    </tr>
    <tr>
        <td colspan="4" style="display: none;">{{ new_line_item_form.product_description }}</td>
    </tr>
</table>
<table id="product_costing" style="display: none;">
    <tr>
        <td>Price</td>
        <td>Discount</td>
        <td>Tax</td>
        <td>Total</td>
    </tr>
    <tr>
        <td>{{ new_line_item_form.product_price }}</td>
        <td>{{ new_line_item_form.discount_percent }}{{ new_line_item_form.discount_amount }} {{ new_line_item_form.discount_choice }}</td>
        <td>{{ new_line_item_form.tax }}{{ new_line_item_form.tax_amount }}</td>
        <td>{{ new_line_item_form.total }}</td>
    </tr>
    <tr>
        <td colspan="4">{{ new_line_item_form.product_note }}</td>
    </tr>
    <tr>
        <td colspan="4"><input type="submit" disabled value="Submit New Line Item"></td>
    </tr>
</table>

<script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/chosen.jquery.js' %}"></script>
<script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/docsupport/prism.js' %}"></script>
<script type="text/javascript" src="{% static 'NearBeach/javascript/chosen-js/docsupport/init.js' %}"></script>

<script>
    /*
    Method
    ~~~~~~
    1.) When the user changes the product/service the system will determine which one it is
    2.) It will apply the default values and hide unwanted fields
    3.) If it is a product, it will extract the base values from the database
     */
    $("#id_product_or_service").on('change', function(evt, params) {
        var label = $(this.options[this.selectedIndex]).closest('optgroup').prop('label');
        var product_id = $(this.options[this.selectedIndex]).val();


        if (label == 'Products') {
            $("#product").find("td").css("display", "");
            $("#product_costing").css("display","");

            //Get the product information
            $.ajax({
                url: '/lookup_product/' + product_id,
                data: {},
                dataType: 'JSON',
                type:'GET',
                success: function(data) {
                    //Write the information to the correct cells

                    //TEMP CODE
                    alert(data);


                    /*
                    $.each(data['errors'], function(key, element){
                         console.log(key+' : '+element['Person']);
                    });
                     */
                    //END TEMP CODE
                },
                error: function(){
                    alert("Sorry");
                }
            });
        }
    })
</script>