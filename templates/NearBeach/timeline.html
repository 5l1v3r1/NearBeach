{% extends "./template.html" %}
{% block content %}
{% load static %}
    <script src="{% static 'NearBeach/javascript/svg.js/svg.js' %}"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <h2>Timeline</h2>
    <ul>
        <li>Start Date: {{ timeline_form.start_date }}</li>
        <li>End Date:{{ timeline_form.end_date }}</li>
    </ul>
    <br/>
    <div id="timeline" style="overflow-x: auto;"></div>
<script>
const month_names = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];


function end_of_month(input_date) {
    var next_day = new Date();
    next_day.setMonth(input_date.getMonth());
    next_day.setDate(input_date.getDate()+1);


    //If the month is the same tomorrow then we are still in the same month
    if (next_day.getMonth() == input_date.getMonth()) {
        return false; //Not the end of the month
    } else {
        return true; //end of the month
    }
}

$( "#id_start_date" ).datepicker({
    dateFormat: "yy-mm-dd"
});
$( "#id_start_date" ).val("{{ start_date|date:'Y-m-d' }}");
//$("#id_start_date").setDate("{{ start_date }}");
$("#id_end_date").datepicker({
    dateFormat: "yy-mm-dd"
});
$("#id_end_date").val("{{ end_date|date:'Y-m-d' }}");


//Start drawing the board
var draw = SVG('timeline').size('100%','100%');
$("#timeline").height(500);


//Required Variables
var start_distance = 600;
var month_start_location = 600;
var month_end_length = 0;
var stroke_prop = { width: 1, color: 'black' }
var _MS_PER_DAY = 1000 * 60 * 60 * 24;
var start_date = new Date("{{ start_date|date:'Y-m-d' }}");
var end_date = new Date("{{ end_date|date:'Y-m-d' }}");



draw.rect(start_distance,90).fill("#fff").stroke(stroke_prop);
for (var i = 0; i < (end_date - start_date)/_MS_PER_DAY; i++) {
    //Loop variables
    var x_cord = 600 + i*100;
    month_end_length = month_end_length + 100;

    //Get the date
    var current_date = new Date();
    current_date.setDate(start_date.getDate() + i);

    //Day number
    draw.rect(100,30).fill("#fff").stroke(stroke_prop).move(x_cord,30);
    draw.text(current_date.getDate().toString()).move(x_cord,30);


    //Hour number
    draw.rect(50,30).fill("#fff").stroke({ width: 1, color: 'black' }).move(x_cord, 60);
    draw.rect(50,30).fill("#fff").stroke({ width: 1, color: 'black' }).move(x_cord+50, 60);
    draw.text("0h").move(x_cord,60);
    draw.text("12h").move(x_cord+50,60);


    if (end_of_month(current_date)) {
        draw.rect(month_end_length,30).fill("#fff").stroke(stroke_prop).move(month_start_location,0);
        draw.text(month_names[current_date.getMonth()]).move(month_start_location,0);


        //Adjust the variables now
        month_start_location = month_start_location + month_end_length;
        month_end_length = 0;
    }


}
//After loop ends we need to add in the last month block
draw.rect(month_end_length,30).fill("#fff").stroke(stroke_prop).move(month_start_location,0);
draw.text(month_names[current_date.getMonth()]).move(month_start_location,0);

alert("Finished");



</script>

{% endblock %}

