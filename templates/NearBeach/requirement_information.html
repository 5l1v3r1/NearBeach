{% extends "./template.html" %}
{% block content %}
{% load static %}
<body onload="on_page_load()">
    <h2>Requirement Information - {{ requirement_id }}</h2>
    <form id="requirement_information" name="requirement_information" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <ul>
            <li>{{ requirement_information_form.requirement_title }}</li>
            <li>{{ requirement_information_form.requirement_scope }}</li>
            <li>Requirement Type: {{ requirement_information_form.requirement_type }}</li>
            <li><input type="submit" value="Update"><input type="submit" value="Resolve" name="resolve"></li>
        </ul>
    </form>
    <h2>Requirement Items</h2>

    <form method="POST" class="requirement_items_list" id="requirement_items_list">
        Loading Table...
    </form>

    <a href="javascript:void(0)" onclick="new_requirement_item()">New Requirement Item</a>

    <form method="POST" class="new_requirement_item" id="new_requirement_item" style="background-color: #b0cfe0;">
    <!-- BLANK - will populate when needed using AJAX -->
    </form>

    <form method="POST" class="edit_requirement_item" id="edit_requirement_item">
    <!-- BLANK - will populate when needed using AJAX -->
    </form>


    <form method="POST" class="requirement_links_list" id="requirement_links_list">
        <h2>Requirement Links</h2>
        Loading...
    </form>

    <script>
        $("#new_requirement_item").on('submit', function(e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/requirement_items_new/{{ requirement_id }}/',
                data: $(this).serialize(),
                success: function() {
                    //Reload the project history :)
                    $("#new_requirement_item").html("");
                    load_requirement_items_list();

                },
                error: function() {
                    alert("Sorry, new requirement item did not save. Please try again.");
                }
            })
        });


        function load_requirement_items_list() {
            //New Requirement Item
            $.ajax({
                url: '/requirement_items_list/{{ requirement_id }}',
                data: {},
                dataType: 'HTML',
                type: 'GET',
                success: function(data) {
                    $("#requirement_items_list").html(data);
                },
                error: function() {
                    $("#requirement_items_list").html("<h2>New Requirement Item</h2>Sorry, new requirement item encounted an error and did not load");
                }
            })

        }


        function new_requirement_item() {
            //New Requirement Item
            $.ajax({
                url: '/requirement_items_new/{{ requirement_id }}',
                data: {},
                dataType: 'HTML',
                type: 'GET',
                success: function(data) {
                    $("#new_requirement_item").html(data);
                },
                error: function() {
                    $("#new_requirement_item").html("<h2>New Requirement Item</h2>Sorry, new requirement item encounted an error and did not load");
                }
            })

        }

        function edit_requirement_item(requirement_item_id) {
            //New Requirement Item
            $.ajax({
                url: '/requirement_item_edit/' + requirement_item_id + '/',
                data: {},
                dataType: 'HTML',
                type: 'GET',
                success: function(data) {
                    $("#edit_requirement_item").html(data);
                },
                error: function() {
                    $("#edit_requirement_item").html("<h2>Edit Requirement Item</h2>Sorry, edit requirement item encounted an error and did not load");
                }
            })

        }



        function requirement_links() {
            //New Requirement Item
            $.ajax({
                url: '/requirement_links_list/{{ requirement_id }}',
                data: {},
                dataType: 'HTML',
                type: 'GET',
                success: function(data) {
                    $("#requirement_links_list").html(data);
                },
                error: function() {
                    $("#requirement_links_list").html("<h2>Edit Requirement Links</h2>Sorry, edit requirement links encounted an error and did not load");
                }
            })

        }

        function on_page_load() {
            //Load all ajax modules
            load_requirement_items_list();
            requirement_links();
        }
    </script>

</body>
{% endblock %}