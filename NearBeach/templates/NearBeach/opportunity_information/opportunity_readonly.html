{% extends "../template.html" %}
{% block content %}
{% load static %}

    <div class="card mt-4">
        <div class="card-header">
            <h1>Opportunity Information</h1>
        </div>
        <div class="card-body">
            {{ opportunity_information_form.media }}
            <div id="save_state"></div>
            <div class="form-group">
                <label for="id_opportunity_name">Opportunity Name</label>
                <h4>{{ opportunity_results.opportunity_name }}</h4>
            </div>
            <div class="form-group">
                <label for="id_opportunity_description">Opportunity Description</label>
                {{ opportunity_information_form.opportunity_description }}
            </div>
            <div class="form-group">
                <label for="id_lead_source_id">Lead Source: {{ opportunity_results.lead_source_id }}</label>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="id_currency_id">Opportunity Budget - currency</label>
                    {{ opportunity_results.currency_id }}
                </div>
                <div class="form-group col-md-3">
                    <label for="id_opportunity_amount">Amount</label>
                    {{ opportunity_results.opportunity_amount }}
                </div>
                <div class="form-group col-md-3">
                    <label for="id_amount_type_id">Rate of Charge</label>
                    {{ opportunity_results.amount_type_id }}
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="id_opportunity_stage_id">Stage of Opportunity</label>
                    {{ opportunity_results.opportunity_stage_id }}
                </div>
                <div class="form-group col-md-2">
                    <div class="form-group">
                        <label for="id_opportunity_success_probability">Success Probability</label>
                        <div class="input-group">
                            {{ opportunity_results.opportunity_success_probability }}
                            <span class="input-group-append">%</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Time zone: {{ timezone }}</label>
            </div>
            <div class="form-group">
                <label for="id_opportunity_expected_close_date">Opportunity Expected Close Date</label>
                {{ opportunity_results.opportunity_expected_close_date }}
            </div>

        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h2>Opportunity Connections</h2>
        </div>
        <div class="card-body" id="id_opportunity_connections">

        </div>
    </div>

    <form id="to_do">
        <div class="card mt-4">
            <div class="card-header">
                <h2>To do</h2>
            </div>
            <div class="card-body">
                Loading...
            </div>
        </div>
    </form>


    <div class="card mt-4">
        <div class="card-header">
            <h2>Email History</h2>
        </div>
        <div class="card-body">
            <div id="email_history">
                Loading...
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <div class="card-header">
            <h2>Opportunity Links</h2>
        </div>
        <div class="card-body">
            <h2 class="mt-2">Assigned Requirements</h2>
            {% if requirement_results %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <td>Requirement ID</td>
                            <td>Requirement Title</td>
                            <td>Requirement Status</td>
                        </tr>
                    </thead>
                    {% for row in requirement_results %}
                        <tr>
                            <td class="col-md-2"><a href="{% url 'requirement_information' row.requirement_id %}">REQ{{ row.requirement_id }}</a></td>
                            <td>{{ row.requirement_title }}</td>
                            <td class="col-md-4">{{ row.requirement_status }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                There are no requirements connected.
            {% endif %}

            <h2 class="mt-2">Assigned Projects</h2>
            {% if project_results %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <td>Project ID</td>
                            <td>Project Name</td>
                            <td>Project End Date</td>
                            <td>Project Status</td>
                        </tr>
                    </thead>
                    {% for row in project_results %}
                        <tr>
                            <td><a href="{% url 'project_information' row.project_id %}">PRO{{ row.project_id }}</a></td>
                            <td>{{ row.project_name }}</td>
                            <td>{{ row.project_end_date }}</td>
                            <td>{{ row.project_status }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>There are no associated projects. Please create a new project</p>
            {% endif %}
            <br/>
            <h2 class="mt-2">Assigned Tasks</h2>
            {% if task_results %}
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <td>Task ID</td>
                            <td>Task Name</td>
                            <td>Task End Date</td>
                            <td>Task Status</td>
                        </tr>
                    </thead>
                    {% for row in task_results %}
                        <tr>
                            <td><a href="{% url 'task_information' row.task_id %}">TASK{{ row.task_id }}</a></td>
                            <td>{{ row.task_short_description }}</td>
                            <td>{{ row.task_end_date }}</td>
                            <td>{{ row.task_status }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>There are no associated tasks. Please create a new task</p>
            {% endif %}
        </div>
    </div>

    <form action="POST" id="tag_results" class="tag_results">
        <div class="card mt-4">
            <div class="card-header">
                <h2>Tags</h2>
            </div>
            <div class="card-body">
                Loading...
            </div>
        </div>
    </form>


    <div class="card mt-4">
        <div class="card-header">
            <h2>Opportunity Quotes</h2>
        </div>
        <div class="card-body">
            {% if quote_results %}
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <td width="50%">Quote Title</td>
                            <td width="25%">Valid Till</td>
                            <td width="25%">Quote Stage</td>
                        </tr>
                    </thead>
                    {% for row in quote_results %}
                        <tr>
                            <td><a href="{% url 'quote_information' row.quote_id %}">{{ row.quote_title }}</a></td>
                            <td>{{ row.quote_valid_till }}</td>
                            <td>{{ row.quote_stage_id }}</td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </div>
    </div>


    {% if opportunity_permission >= 3 %}
        <div class="card mt-4">
            <div class="card-header">
                <h2>Assigned Users</h2>
            </div>
            <div class="card-body">
                <form method="post" class="assigned_users" id="assigned_users">
                    Loading...
                </form>
                <div id="assigned_user_list">Loading list...</div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h2>Assigned Groups</h2>
            </div>
            <div class="card-body">
                <form method="post" class="assigned_groups" id="assigned_groups">
                    Loading add...
                </form>
                <div id="assigned_group_list">Loading list...</div>
            </div>
        </div>
    {% endif %}
{% endblock %}