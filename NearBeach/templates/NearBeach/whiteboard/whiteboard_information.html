{% extends "../template_wider.html" %}
{% block content %}
{% load nearbeach_extras %}
{% load static %}
    <!-- Basic Styling -->
    <style type="text/css" media="screen">
		div.base {
			position: absolute;
			overflow: hidden;
			font-family: Arial;
			font-size: 8pt;
		}
		div.base#graph {
			border-style: solid;
			border-color: #F2F2F2;
			border-width: 1px;
			background: url('{% static "NearBeach/whiteboard/images/grid.gif" %}');
		}
	</style>

    <!-- Sets the basepath for the library if not in same directory -->
	<script type="text/javascript">
		mxBasePath = "{% static 'NearBeach' %}";
	</script>


    <!-- Loading splash -->
    <!--
    <table id="splash" width="100%" height="100%"
		style="background:white;position:absolute;top:0px;left:0px;z-index:4;">
		<tr>
			<td align="center" valign="middle">
				<img src="{% static 'NearBeach/images/icons/loader.svg' %}">
                <div>Loading Whiteboard</div>
			</td>
		</tr>
	</table>
	-->

    <!-- MX Graph Source Code -->
    <script type="text/javascript" src="{% static 'NearBeach/js/mxClient.min.js' %}"></script>

    <script type="text/javascript">
		mxGraph.prototype.htmlLabels = true;

		mxGraph.prototype.isWrapping = function(cell)
		{
			return true;
		};

		mxConstants.DEFAULT_HOTSPOT = 1;

		// Enables guides
		mxGraphHandler.prototype.guidesEnabled = true;

	    // Alt disables guides
	    mxGuide.prototype.isEnabledForEvent = function(evt)
	    {
	    	return !mxEvent.isAltDown(evt);
	    };

		// Enables snapping waypoints to terminals
		mxEdgeHandler.prototype.snapToTerminals = true;

		window.onbeforeunload = function() { return mxResources.get('changesLost'); };
	</script>

	<!-- Loads and initializes the library -->
    <div id="graph" class="base">
        <!-- Graph Here -->
	</div>

	<div id="status" class="base" align="right" style="white-space:nowrap;">
		<!-- Status Here -->
	</div>

    <script>
        function createEditor(config)
        {
            var editor = null;

            var hideSplash = function()
            {
                // Fades-out the splash screen
                var splash = document.getElementById('splash');

                if (splash != null)
                {
                    try
                    {
                        mxEvent.release(splash);
                        mxEffects.fadeOut(splash, 100, true);
                    }
                    catch (e)
                    {
                        splash.parentNode.removeChild(splash);
                    }
                }
            };

            try
            {
                if (!mxClient.isBrowserSupported())
                {
                    mxUtils.error('Browser is not supported!', 200, false);
                }
                else
                {
                    mxObjectCodec.allowEval = true;
                    var node = mxUtils.load(config).getDocumentElement();
                    editor = new mxEditor(node);
                    mxObjectCodec.allowEval = false;

                    // Adds active border for panning inside the container
                    editor.graph.createPanningManager = function()
                    {
                        var pm = new mxPanningManager(this);
                        pm.border = 30;

                        return pm;
                    };

                    editor.graph.allowAutoPanning = true;
                    editor.graph.timerAutoScroll = true;

                    // Updates the window title after opening new files
                    var title = document.title;
                    var funct = function(sender)
                    {
                        document.title = title + ' - ' + sender.getTitle();
                    };

                    editor.addListener(mxEvent.OPEN, funct);

                    // Prints the current root in the window title if the
                    // current root of the graph changes (drilling).
                    editor.addListener(mxEvent.ROOT, funct);
                    funct(editor);

                    // Displays version in statusbar
                    editor.setStatus('mxGraph '+mxClient.VERSION);

                    // Shows the application
                    hideSplash();
                }
            }
            catch (e)
            {
                hideSplash();

                // Shows an error message if the editor cannot start
                mxUtils.alert('Cannot start application: ' + e.message);
                throw e; // for debugging
            }

            return editor;
        }

        window.onload = function() {
            console.log("PAGE HAS LOADED");

            createEditor("{% url 'whiteboard_editor_xml' %}");

            console.log("Scripts have finished running");
        }
    </script>
{% endblock %}